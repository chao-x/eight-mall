<!DOCTYPE html>
<html lang="en" xmlns:v-on="http://www.w3.org/1999/xhtml">
<head>
    <meta charset="UTF-8">
    <title>注册</title>
    <script src="js/vue.js"></script>
    <script src="js/axios.min.js"></script>
    <script src="element-ui/index.js"></script>
    <script src="component/header_login/header_login.js"></script>
    <script src="component/header_login/footer_login.js"></script>
    <link rel="stylesheet" type="text/css" href="element-ui/index.css">
    <link rel="stylesheet" type="text/css" href="component/header_login/header_login.css">
    <link rel="stylesheet" type="text/css" href="component/header_login/footer_login.css">
    <link rel="stylesheet" type="text/css" href="css/register.css">
</head>
<body style="height: 100%;padding: 0px;margin: 0">
    <div id="app" style="height: 100%;padding: 0px;margin: 0">
        <header_login></header_login>
        <div style="min-height: 700px;height: calc(100% - 155px);background: #fff;">
            <div class="register_main_container">
                <div class="register_main">
                    <div class="register_main_left_tab">
                        <div class="register_main_tabItem" :class="{tab_selected: isPhone==true}" v-on:click="onPhoneChange">
                            <div class="register_main_text_container" >
                                <i class="register_icon register_phoneIcon"></i>
                                <span class="text_container"><span>手机号注册</span></span>
                            </div>
                        </div>
                        <div class="register_main_tabItem" :class="{tab_selected: isPhone==false}" v-on:click="onMailChange">
                            <div class="register_main_text_container" >
                                <i class="register_icon register_emailIcon"></i>
                                <span class="text_container"><span>邮箱注册</span></span>
                            </div>
                        </div>
                    </div>
                    <div class="register_main_content">
                        <div>
                            <div class="register_main_detail_container">
                                <div class="register_title">
                                    <div class="main_title"><span class="title_text_container">账号注册</span></div>
                                    <div class="login_link">
                                        <span class="title_text_container">
                                            <span>已有账号，</span>
                                        </span>
                                        <div class="reg_link">
                                            <span class="register_login_link">
                                                <span class="title_text_container">
                                                    <span v-on:click="goto_login">去登陆</span>
                                                </span>
                                            </span>
                                            <span class="right_arrow"></span>
                                        </div>
                                    </div>
                                </div>
                                <div class="register_input_parentDiv">
                                    <div class="input_container">
                                        <div class="input_content">
                                            <input onkeyup="value=value.replace(/[\u4e00-\u9fa5]/ig,'')" type="text" tabindex="1" maxlength="80" autocomplete="off" :placeholder="accountText" v-model="account" class="register_input" v-on:blur="accountCheck" v-on:input="ChangeOpacity">
                                        </div>
                                    </div>
                                    <div class="register_input_error_msg" >
                                        <div class="error_div" v-if="accountError">
                                            <i class="ic_tips register_icon"></i>
                                            <span>{{accountErrorMessage}}</span>
                                        </div>
                                    </div>
                                </div>
                                <div class="register_input_parentDiv">
                                    <div>
                                        <div class="register_input_msg_container">
                                            <div class="input_container">
                                                <div class="input_content">
                                                    <input type="text" tabindex="1" maxlength="80" autocomplete="off" placeholder="密码" v-model="password" class="register_input" v-on:blur="passwordCheck" v-on:input="ChangeOpacity" :class="{secOn:!isPwdEyeOn}">
                                                    <i class="password_eye password_eye_on" v-if="isPwdEyeOn" v-on:click="ChangePwdSec"></i>
                                                    <i class="password_eye password_eye_off" v-else v-on:click="ChangePwdSec"></i>
                                                </div>
                                            </div>
                                            <div class="register_input_error_msg">
                                                <div class="error_div" v-if="passwordError">
                                                    <i class="ic_tips register_icon"></i>
                                                    <span>密码不能为空</span>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                <div class="register_input_parentDiv">
                                    <div>
                                        <div class="register_input_msg_container">
                                            <div class="input_container">
                                                <div class="input_content">
                                                    <input type="text" tabindex="1" maxlength="80" autocomplete="off" placeholder="确认密码" v-model="re_password" class="register_input" v-on:blur="repasswordCheck" v-on:input="ChangeOpacity" :class="{secOn:!isrePwdEyeOn}">
                                                    <i class="password_eye password_eye_on" v-if="isrePwdEyeOn" v-on:click="ChangerePwdSec"></i>
                                                    <i class="password_eye password_eye_off" v-else v-on:click="ChangerePwdSec"></i>
                                                </div>
                                            </div>
                                            <div class="register_input_error_msg">
                                                <div class="error_div" v-if="re_passwordError">
                                                    <i class="ic_tips register_icon"></i>
                                                    <span>{{re_passwordErrorMessage}}</span>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                <div class="que_res_container">
                                    <div class="register_input_parentDiv">
                                        <div class="input_container">
                                            <div class="input_content">
                                                <input type="text" tabindex="1" maxlength="80" autocomplete="off" placeholder="密保问题" v-model="question" class="register_input" v-on:blur="questionCheck" v-on:input="ChangeOpacity">
                                            </div>
                                        </div>
                                        <div class="register_input_error_msg">
                                            <div class="error_div" v-if="queError">
                                                <i class="ic_tips register_icon"></i>
                                                <span>密保问题不能为空</span>
                                            </div>
                                        </div>
                                    </div>
                                    <i class="helptip_icon" v-on:mouseover="showHelpTip_Que" v-on:mouseout="coverHelpTip_Que">
                                        <div class="help_tip_msg_parent" v-if="showHelpTip_que">
                                            <div class="helptip_msg_ctr" style="top: -22px; left: 35px;" >您的密保问题会在找回密码时显示</div>
                                            <div class="helptip_triangle"></div>
                                        </div>
                                    </i>
                                </div>
                                <div class="que_res_container">
                                    <div class="register_input_parentDiv">
                                        <div class="input_container">
                                            <div class="input_content">
                                                <input type="text" tabindex="1" maxlength="80" autocomplete="off" placeholder="密保答案" v-model="result" class="register_input" v-on:blur="resultCheck" v-on:input="ChangeOpacity">
                                            </div>
                                        </div>
                                        <div class="register_input_error_msg">
                                            <div class="error_div" v-if="resError">
                                                <i class="ic_tips register_icon"></i>
                                                <span>密保答案不能为空</span>
                                            </div>
                                        </div>
                                    </div>
                                    <i class="helptip_icon" v-on:mouseover="showHelpTip_Res" v-on:mouseout="coverHelpTip_Res">
                                        <div class="help_tip_msg_parent"  v-if="showHelpTip_res">
                                            <div class="helptip_msg_ctr" style="top: -22px; left: 35px;" >您的密保答案可以帮助您找回密码</div>
                                            <div class="helptip_triangle"></div>
                                        </div>
                                    </i>
                                </div>
                                <div class="register_btn_container">
                                    <input type="button" value="注册" tabindex="7" class="submit_button" :class="{lighted: isEmpty==false}" v-on:click="Register">
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <footer_login></footer_login>
    </div>
</body>
<script>
    new Vue({
        el:"#app",
        data(){
            return{
                accountErrorMessage:"",
                re_passwordErrorMessage:"",
                accountText:"邮件地址",
                isPwdEyeOn:false,
                isrePwdEyeOn:false,
                isPhone:false,//判断手机注册还是邮箱注册
                accountError:false,//判断账号（手机邮箱）格式是否正确
                passwordError:false,//判断密码是否为空
                re_passwordError:false,//判断确认密码是否为空
                isEmpty:true,
                queError:false,
                resError:false,
                showHelpTip_res:false,
                showHelpTip_que:false,
                account:"",
                password:"",
                re_password:"",
                question:"",
                result:"",
            }
        },
        methods:{
            onPhoneChange(){
                this.isPhone=true;
                this.accountText="手机号码";
                this.account="";
                this.accountError=false;
            },
            onMailChange(){
                this.isPhone=false;
                this.accountText="邮件地址";
            },
            //判断输入框内是否为空，并以此作为依据更改登录按钮的透明度
            ChangeOpacity(){
                if(this.account!=""&&this.password!=""&&this.re_password!=""&&this.question!=""&&this.result!="")
                {
                    this.isEmpty=false;
                }else
                {
                    this.isEmpty=true;
                }
            },
            accountCheck(){
                if(this.isPhone){
                //    使用手机号码的正则表达式验证
                    if(!/^1[3|4|5|7|8][0-9]{9}$/.test(this.account)) {
                        this.accountError=true;
                        this.accountErrorMessage="手机号码有误"
                    }else {
                        this.accountError=false;
                    }
                }else {
                       // 使用邮件地址的正则表达式验证
                    if(!/^[A-Za-z0-9-._]+@[A-Za-z0-9-]+(\.[A-Za-z0-9]+)*(\.[A-Za-z]{2,6})$/.test(this.account)){
                        this.accountError=true;
                        this.accountErrorMessage="邮箱地址有误"
                    }else {
                        this.accountError=false;
                    }
                }
            },
            passwordCheck(){
                if(this.password==""){
                    this.passwordError=true;
                }else {
                    this.passwordError=false;
                }
            },
            repasswordCheck(){
                if(this.re_password==""){
                    this.re_passwordError=true;
                    this.re_passwordErrorMessage="确认密码不能为空";
                }else {
                    if(this.re_password!=this.password){
                        this.re_passwordError=true;
                        this.re_passwordErrorMessage="确认密码与密码不符";
                    }else{
                        this.re_passwordError=false;
                    }
                }
            },
            questionCheck(){
                if(this.question==""){
                    this.queError=true;
                }else {
                    this.queError=false;
                }
            },
            resultCheck(){
                if(this.result==""){
                    this.resError=true;
                }else {
                    this.resError=false;
                }
            },
            ChangerePwdSec(){
                if(this.isrePwdEyeOn){
                    this.isrePwdEyeOn=false;
                }else {
                    this.isrePwdEyeOn=true;
                }
            },
            ChangePwdSec(){
                if(this.isPwdEyeOn){
                    this.isPwdEyeOn=false;
                }else {
                    this.isPwdEyeOn=true;
                }
            },
            showHelpTip_Que(){
                this.showHelpTip_que=true;
            },
            coverHelpTip_Que(){
                this.showHelpTip_que=false;
            },
            showHelpTip_Res(){
                this.showHelpTip_res=true;
            },
            coverHelpTip_Res(){
                this.showHelpTip_res=false;
            },
            goto_login(){
                window.location.href = "/login.html";
            },
            Register(){
                if(!this.accountError&&!this.passwordError&&!this.re_passwordError&&!this.queError&&!this.resError){
                //    验证该手机或是该邮箱是否有人注册了
                    var testtype;
                    if(this.isPhone){
                        testtype="phone";
                    }else {
                        testtype="email";
                    }
                    var testdata={
                        info:this.account,
                        type:testtype,
                    }
                    console.log(testdata)
                    axios.post('/actionmall/user/do_check_info.do',testdata).then(res=>{
                        var resdata=res.data;
                        //注册的手机或邮箱已存在
                        if(resdata.status==1){
                            this.accountError=true;
                            this.accountErrorMessage=resdata.msg;
                        }else {
                        //    注册的账号不存在，可以继续进行
                            var regemail,regphone;
                            if(this.isPhone){
                                regphone=this.account;
                                regemail="";
                            }else {
                                regphone="";
                                regemail=this.account;
                            }
                            var registerData={
                                account:this.account,
                                password: this.password,
                                email:regemail,
                                phone:regphone,
                                question: this.question,
                                asw: this.result,
                            }
                            axios.post('/actionmall/user/do_register.do',registerData).then(response=>{
                                var resultdata=response.data;
                                if(resultdata.status==0){
                                    this.$message({
                                        message: "注册成功",
                                        type: "success"
                                    });
                                    console.log(resultdata);
                                }
                            })
                        }
                    })
                }
            }
        }
    })
</script>
</html>