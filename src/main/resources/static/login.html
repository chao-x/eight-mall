<!DOCTYPE html>
<html lang="en" xmlns:v-on="http://www.w3.org/1999/xhtml">
<head>
    <meta charset="UTF-8">
    <title>登录</title>
    <script src="js/vue.js"></script>
    <script src="js/axios.min.js"></script>
    <script src="element-ui/index.js"></script>
    <script src="component/header_login/header_login.js"></script>
    <script src="component/header_login/footer_login.js"></script>
    <link rel="stylesheet" type="text/css" href="element-ui/index.css">
    <link rel="stylesheet" type="text/css" href="component/header_login/header_login.css">
    <link rel="stylesheet" type="text/css" href="component/header_login/footer_login.css">
    <link rel="stylesheet" type="text/css" href="css/login.css">
</head>
<body style="height: 100%;padding: 0px;margin: 0">
    <div id="app" style="height: 100%;padding: 0px;margin: 0">
        <header_login></header_login>
        <div class="mall_login_root">
            <div class="mall_login_container">
                <div class="mall_login_Title">
                    <span>第八组商城登录</span>
                </div>
                <div style="text-align: center">
                    <div class="mall_login_leftside">
                        <div class="imgbox">
                            <img style="display: block;" src="image/QRcode.png">
                        </div>
                        <div class="qrcode_desc">
                            <span class="mall_login_text">
                                <span>请打开手机扫描二维码</span>
                            </span>
                        </div>
                    </div>
                    <span class="fullpage_split_line"></span>
                    <div class="mall_login_rightside">
                        <div class="mall_login_form">
                            <div class="mall_login_error_container" :class="{errorAccount: isError==true}">
                                <div class="mall_login_error" >
                                    <span>您输入的账号密码有误</span>
                                </div>
                            </div>
                            <div class="mall_login_form_account_container">
                                <div class="input_border">
                                    <div class="input_wrap">
                                        <input v-on:input="ChangeOpacity" type="text" autocomplete="off" maxlength="150" placeholder="用户名/手机号" v-model="account" class="account_input">
                                    </div>
                                </div>
                            </div>
                            <div class="mall_login_form_password_container">
                                <div>
                                    <div class="input_border">
                                        <div class="input_wrap">
                                            <input v-on:input="ChangeOpacity" type="text" autocomplete="off" maxlength="150" placeholder="密码" v-model="password" class="password_input">
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div class="mall_login_form_button_container">
                                <div class="button_border">
                                    <div class="button_wrap" :class="{lighted: isEmpty==false}" v-on:click="Login">
                                        <span>登录</span>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="mall_login_form_full_link">
                            <span class="loginpage_linkl"><span class="link_text_container"><span>注册</span></span></span>
                            <span class="loginpage_link"><span class="link_text_container"><span>忘记密码</span></span></span>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <footer_login></footer_login>
    </div>
    <script>
        new Vue({
            el:'#app',
            data(){
                return {
                    account: "",
                    password: "",
                    isEmpty: true,//判断输入框为空
                    isError:false,//判断输入账号是否正确
                };
            },
            methods:{
                //判断输入框内是否为空，并以此作为依据更改登录按钮的透明度
                ChangeOpacity(){
                    if(this.account!=""&&this.password!="")
                    {
                        this.isEmpty=false;
                    }else
                    {
                        this.isEmpty=true;
                    }
                },
                Login(){
                    if(this.account==""&&this.password=="")
                    {
                        this.isError=true;
                    }else
                    {
                        var data={
                            "account":this.account,
                            "password":this.password,
                        }
                        axios.post('/actionmall/user/do_login.do',data).then(res=>{
                            var resultdata=res.data;
                            if(resultdata.status==0)
                            {
                                if(resultdata.data.role==1)
                                {
                                    this.$message({
                                        message: "登录成功",
                                        type: "success"
                                    });
                                    setTimeout(()=>{
                                        window.location.href = "/admin/commodity.html";
                                    }, 2000);
                                }else {
                                    this.$message({
                                        message: "登录成功",
                                        type: "success"
                                    });
                                    localStorage.setItem("user", JSON.stringify(resultdata.data));
                                    setTimeout(()=>{
                                        window.location.href = "/userCenter.html";
                                    }, 2000);
                                }
                            }else {
                                this.isError=true;
                            }
                        })
                    }
                }
            }
        })
    </script>
</body>
</html>